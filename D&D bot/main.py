import logging
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, ContextTypes
import random

logging.basicConfig(format='%(asctime)s - %(name)s - %(levelname)s - %(message)s', level=logging.INFO)

THEME_OPTIONS = [
    "–¢–µ–º–Ω–æ–µ —Ñ—ç–Ω—Ç–µ–∑–∏",
    "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ —Ñ—ç–Ω—Ç–µ–∑–∏",
    "–°—Ç–∏–º–ø–∞–Ω–∫",
    "–ú–∞–≥–∏—á–µ—Å–∫–∞—è —Å–∫–∞–∑–∫–∞",
    "–¢–µ—Ö–Ω–æ–≥–µ–Ω–Ω–æ–µ –±—É–¥—É—â–µ–µ",
    "–î—Ä–µ–≤–Ω—è—è –º–∏—Ñ–æ–ª–æ–≥–∏—è",
    "–ö–æ—Å–º–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ",
    "–ü–æ—Å—Ç–∞–ø–æ–∫–∞–ª–∏–ø—Å–∏—Å",
    "–ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã–π —Ö–æ—Ä—Ä–æ—Ä",
    "–°–∫–∞–∑–æ—á–Ω–æ–µ –∫–æ—Ä–æ–ª–µ–≤—Å—Ç–≤–æ"
]

OBJECTIVES = [
    "–Ω–∞–π—Ç–∏ –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –º–µ—á –¥—Ä–µ–≤–Ω–∏—Ö –∫–æ—Ä–æ–ª–µ–π",
    "–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—É –º–∏—Ä–æ–≤",
    "–æ—Å–≤–æ–±–æ–¥–∏—Ç—å –∑–∞—Ö–≤–∞—á–µ–Ω–Ω—É—é –¥–µ—Ä–µ–≤–Ω—é",
    "–∑–∞—â–∏—Ç–∏—Ç—å —Å–≤—è—â–µ–Ω–Ω—ã–π —Ö—Ä–∞–º –æ—Ç –Ω–∞—à–µ—Å—Ç–≤–∏—è –≤—Ä–∞–≥–æ–≤",
    "—Ä–∞–∑—ã—Å–∫–∞—Ç—å –ø—Ä–æ–ø–∞–≤—à–µ–≥–æ —É—á–µ–Ω–∏–∫–∞ –º–∞–≥–∞",
    "–æ—á–∏—Å—Ç–∏—Ç—å —Ä—É–∏–Ω—ã –¥—Ä–µ–≤–Ω–µ–≥–æ –≥–æ—Ä–æ–¥–∞ –æ—Ç –º–æ–Ω—Å—Ç—Ä–æ–≤",
    "—Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –∑–∞–≥–∞–¥–æ—á–Ω—ã–µ —É–±–∏–π—Å—Ç–≤–∞ –≤ —Å—Ç–æ–ª–∏—Ü–µ",
    "—Å–æ–±—Ä–∞—Ç—å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –¥–ª—è –º–æ—â–Ω–æ–≥–æ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è",
    "–ø–æ–º–æ—á—å –±–µ–∂–µ–Ω—Ü–∞–º –¥–æ–±—Ä–∞—Ç—å—Å—è –¥–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –º–µ—Å—Ç–∞",
    "–∏–∑—É—á–∏—Ç—å –º–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —è–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–≥–∏–æ–Ω–µ",
    "—Ä–∞—Å–∫—Ä—ã—Ç—å –∑–∞–≥–æ–≤–æ—Ä –ø—Ä–æ—Ç–∏–≤ –ø—Ä–∞–≤–∏—Ç–µ–ª—è",
    "—É—Å–º–∏—Ä–∏—Ç—å –≤–∑–±—É–Ω—Ç–æ–≤–∞–≤—à–µ–≥–æ—Å—è –¥—Ä–∞–∫–æ–Ω–∞",
    "–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ —Å—Ç–∏—Ö–∏–π",
    "–∑–∞—â–∏—â–∞—Ç—å –∫–∞—Ä–∞–≤–∞–Ω –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤"
]

TWISTS = [
    "–û–¥–∏–Ω –∏–∑ —á–ª–µ–Ω–æ–≤ –≥—Ä—É–ø–ø—ã –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–≤–æ–π–Ω–∏–∫–æ–º –∑–ª–æ–¥–µ—è",
    "–ì–µ—Ä–æ–µ–≤ –∑–∞–º–∞–Ω–∏–≤–∞–µ—Ç –ª–æ–≤—É—à–∫–∞, –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω–∞—è –≤—Ä–∞–≥–æ–º",
    "–ù–∞—Å—Ç–æ—è—â–∏–π –≤—Ä–∞–≥ —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å—Ä–µ–¥–∏ —Å–æ—é–∑–Ω–∏–∫–æ–≤",
    "–ü—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∏ –Ω–∞—Ö–æ–¥—è—Ç –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã–π –¥–Ω–µ–≤–Ω–∏–∫ —Å—Ç–∞—Ä–æ–≥–æ –≥–µ—Ä–æ—è",
    "–û–¥–Ω–∞ –∏–∑ –≤–∞–∂–Ω—ã—Ö —Ä–µ–ª–∏–∫–≤–∏–π –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–¥–¥–µ–ª–∫–æ–π",
    "–í–æ–∑–Ω–∏–∫–∞—é—Ç —Ä–∞–∑–Ω–æ–≥–ª–∞—Å–∏—è –º–µ–∂–¥—É —á–ª–µ–Ω–∞–º–∏ –ø–∞—Ä—Ç–∏–∏",
    "–û–∫–∞–∑–∞–ª–æ—Å—å, —á—Ç–æ —Ü–µ–ª—å —ç–∫—Å–ø–µ–¥–∏—Ü–∏–∏ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –ª–æ–∂–Ω–∞—è",
    "–¢–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–æ—é–∑–Ω–∏–∫ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç —Å–≤–æ–µ –∏—Å—Ç–∏–Ω–Ω–æ–µ –ª–∏—Ü–æ",
    "–ó–∞–∫–ª—é—á—ë–Ω–Ω—ã–π –¥–æ–≥–æ–≤–æ—Ä –Ω–∞—Ä—É—à–∞–µ—Ç –±–∞–ª–∞–Ω—Å —Å–∏–ª",
    "–°–≤—è—â–µ–Ω–Ω—ã–π –∞–º—É–ª–µ—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–æ—Ä—Ç–∞–ª –≤ –¥—Ä—É–≥–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ"
]

REWARDS = [
    "—Å–æ–∫—Ä–æ–≤–∏—â–∞ –¥—Ä–µ–≤–Ω–µ–π—à–∏—Ö –≤—Ä–µ–º–µ–Ω",
    "–ª–µ–≥–µ–Ω–¥–∞—Ä–Ω–æ–µ –æ—Ä—É–∂–∏–µ –ø—Ä–æ—à–ª–æ–≥–æ",
    "–≤–æ–ª—à–µ–±–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã —Å –æ—Å–æ–±—ã–º–∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏",
    "—Ü–µ–Ω–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è –∏ –∫–∞—Ä—Ç—ã —Å–æ–∫—Ä–æ–≤–∏—â",
    "–±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–µ –±–æ–≥–æ–≤",
    "–æ–ø—ã—Ç –∏ –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π",
    "–Ω–æ–≤—ã–µ –±–æ–µ–≤—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –∏ —É–º–µ–Ω–∏—è",
    "—Å—Ç–∞—Ä—ã–µ –ª–µ–≥–µ–Ω–¥—ã –∏ –ø—Ä–æ—Ä–æ—á–µ—Å—Ç–≤–∞",
    "–∫–ª—é—á –∫ —Å–µ–∫—Ä–µ—Ç–Ω–æ–º—É —Ö—Ä–∞–Ω–∏–ª–∏—â—É",
    "—á–µ—Ä—Ç–µ–∂–∏ —É—Ç—Ä–∞—á–µ–Ω–Ω–æ–π —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏"
]

PLACES = [
    "—Ç–µ–º–Ω—ã–π –≥—Ä–æ—Ç –∑–∞–±—Ä–æ—à–µ–Ω–Ω—ã—Ö —à–∞—Ö—Ç",
    "—Å—Ç–∞—Ä–∏–Ω–Ω—ã–π –∑–∞–±—Ä–æ—à–µ–Ω–Ω—ã–π –º–æ–Ω–∞—Å—Ç—ã—Ä—å",
    "–∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–µ –ª–µ–¥—è–Ω—ã–µ –ø—É—Å—Ç–æ—à–∏",
    "–ø–æ—Ç—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–µ —Ü–∞—Ä—Å—Ç–≤–æ —Ç–µ–Ω–µ–π",
    "–≥–æ—Ä–æ–¥-–ø—Ä–∏–∑—Ä–∞–∫ –Ω–∞ –æ–∫—Ä–∞–∏–Ω–∞—Ö —Å–≤–µ—Ç–∞",
    "–ª–µ—Å —á—É–¥–æ–≤–∏—â –∏ –∏–ª–ª—é–∑–∏–π",
    "–≥–æ—Ä—è—â–∏–µ –ø—É—Å—Ç—ã–Ω–∏ —Å–º–µ—Ä—Ç–∏",
    "–æ–∑–µ—Ä–æ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö –≤–æ–¥",
    "–æ–∫–µ–∞–Ω—Å–∫–∏–µ –≥–ª—É–±–∏–Ω—ã –ê—Ç–ª–∞–Ω—Ç–∏–¥—ã",
    "–≥–æ—Ä–Ω—ã–µ –ø–µ—Ä–µ–≤–∞–ª—ã –≥–∏–≥–∞–Ω—Ç–æ–≤",
    "—É—â–µ–ª—å–µ –¥—É—à –º–µ—Ä—Ç–≤—ã—Ö",
    "—Å–≤—è—â–µ–Ω–Ω—ã–π –≤—É–ª–∫–∞–Ω –¥—Ä–µ–≤–Ω–µ–π –∏–º–ø–µ—Ä–∏–∏",
    "–Ω–µ–≤–µ–¥–æ–º—ã–µ –ø–µ—â–µ—Ä—ã —Å –∂—É—Ç–∫–∏–º–∏ –æ–±–∏—Ç–∞—Ç–µ–ª—è–º–∏",
    "–∏—Å–∫—Ä—è—â–∏–µ—Å—è –ø–æ–ª—è —Å—Ä–∞–∂–µ–Ω–∏–π –¥–∞–≤–Ω–æ –º–∏–Ω—É–≤—à–∏—Ö –≤–æ–π–Ω"
]

ENCOUNTERS = [
    "–∑–∞–≥–∞–¥–æ—á–Ω—ã–π —á–∞—Ä–æ–¥–µ–π",
    "—É–∂–∞—Å–∞—é—â–∏–π –¥–µ–º–æ–Ω –≥–ª—É–±–∏–Ω",
    "–º–∏—Å—Ç–∏—á–µ—Å–∫–∏–π —Ö—Ä–∞–Ω–∏—Ç–µ–ª—å –∑–Ω–∞–Ω–∏–π",
    "—Å—Ç—Ä–∞–∂-–∫–µ–Ω—Ç–∞–≤—Ä —Å –∞—Ä–±–∞–ª–µ—Ç–æ–º",
    "–¥–µ–º–æ–Ω–∏—á–µ—Å–∫–∏–π —Ä—ã—Ü–∞—Ä—å-—Ç–µ–Ω–µ–π",
    "–¥–≤—É—Ö–≥–æ–ª–æ–≤—ã–π –¥—Ä–∞–∫–æ–Ω",
    "–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è –±–µ–∑—É–º–Ω–æ–≥–æ —É—á—ë–Ω–æ–≥–æ",
    "–∞—Ä–º–∏—è –Ω–µ–∂–∏—Ç–∏",
    "—Ö—Ä–∞–Ω–∏—Ç–µ–ª–∏ –¥—Ä–µ–≤–Ω–∏—Ö –≤—Ä–∞—Ç",
    "–ø–æ—Å–µ–ª–æ–∫ –¥—É—Ö–æ–≤ –ª–µ—Å–∞",
    "—Å—Ç–∞—Ä—à–∏–π –±—Ä–∞—Ç–∞ –≥–ª–∞–≤–Ω–æ–≥–æ –≥–µ—Ä–æ—è",
    "–ø–∞—Ä—è—â–∞—è –∫—Ä–µ–ø–æ—Å—Ç—å —Å –¥—Ä–∞–∫–æ–Ω–∞–º–∏-—Å—Ç—Ä–∞–∂–∞–º–∏",
    "–≥–∏–±—Ä–∏–¥–Ω–æ–µ —Å—É—â–µ—Å—Ç–≤–æ —Å –¥–≤—É–º—è –ª–∏—Ü–∞–º–∏",
    "–ø–µ—Ä–µ–≤–æ–ø–ª–æ—â—ë–Ω–Ω—ã–π –∞–Ω–≥–µ–ª —Ç—å–º—ã"
]

PERSONALITIES = [
    "–º–µ—á–µ–Ω–æ—Å–µ—Ü —Å –¥–æ–±—Ä—ã–º —Å–µ—Ä–¥—Ü–µ–º",
    "–∑–∞–≥–∞–¥–æ—á–Ω–∞—è –≤–µ–¥—å–º—É —Å —Ç—ë–º–Ω—ã–º–∏ —Å–∏–ª–∞–º–∏",
    "—É—Å—Ç–∞–ª—ã–π –ø—É—Ç–Ω–∏–∫-–º–æ–Ω–∞—Ö",
    "–≤–µ—Å—ë–ª—ã–π –≤–æ–ª—à–µ–±–Ω–∏–∫-–ø–∏—Ä–æ–º–∞–Ω—Ç",
    "–ª–æ–≤–∫–∏–π –º–∞—Å—Ç–µ—Ä –∑–∞–º–∫–æ–≤",
    "–¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –¥—Ä–æ–≤–æ—Å–µ–∫-–≥–∏–≥–∞–Ω—Ç",
    "–∫–∞–ø–∏—Ç–∞–Ω –∫–æ—Ä–∞–±–ª–µ–π –º—Ä–∞—á–Ω–æ–≥–æ –º–æ—Ä—è",
    "–ø–µ—Ä–≤–æ–±—ã—Ç–Ω—ã–π —à–∞–º–∞–Ω —Å –∂–∏–≤–æ—Ç–Ω—ã–º–∏ –¥—É—Ö–∞–º–∏",
    "–≤–∑–¥–æ—Ä–Ω—ã–π —é–≤–µ–ª–∏—Ä-—Ö–∏—Ä—É—Ä–≥",
    "—É—á—ë–Ω—ã–π-–∏–∑–æ–±—Ä–µ—Ç–∞—Ç–µ–ª—å —Å –∞–º–±–∏—Ü–∏–æ–∑–Ω—ã–º–∏ –ø–ª–∞–Ω–∞–º–∏",
    "—Ü–µ–ª–∏—Ç–µ–ª—å-–∑–Ω–∞—Ö–∞—Ä—å —Å —Ä–µ–¥–∫–∏–º–∏ —Ç—Ä–∞–≤–∞–º–∏",
    "—Å—É—Ä–æ–≤–∞—è –∂–µ–Ω—â–∏–Ω–∞-–≤–æ–∏–Ω",
    "—Å—É–º–∞—Å—à–µ–¥—à–∞—è —Ö–æ–∑—è–π–∫–∞ –≥–æ—Å—Ç–∏–Ω–∏—Ü—ã",
    "–Ω–µ–∫—Ä–æ–º–∞–Ω—Ç, –±–æ—Ä—é—â–∏–π—Å—è —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º —Å–æ–∑–¥–∞–Ω–∏–µ–º"
]

BACKGROUNDS = [
    "–í —ç–ø–æ—Ö—É —É–ø–∞–¥–∫–∞ –≤–µ–ª–∏–∫–æ–π –∏–º–ø–µ—Ä–∏–∏",
    "–í–æ –≤—Ä–µ–º–µ–Ω–∞ —Ä–∞—Å—Ü–≤–µ—Ç–∞ –º–∞–≥–∏–∏",
    "–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –∫–∞—Ç–∞–∫–ª–∏–∑–º–æ–≤",
    "–í –∫–æ–Ω—Ü–µ —Ç—ã—Å—è—á–µ–ª–µ—Ç–Ω–µ–≥–æ –∑–∞—Ç–∏—à—å—è",
    "–ó–∞ –≥—Ä–∞–Ω—å—é —Ü–∏–≤–∏–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –º–∏—Ä–∞",
    "–í —É—Å–ª–æ–≤–∏—è—Ö –∞–ø–æ–∫–∞–ª–∏–ø—Å–∏—Å–∞",
    "–í –ø–µ—Ä–∏–æ–¥ –≤–µ–ª–∏–∫–∏—Ö –ø–µ—Ä–µ–º–µ–Ω –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤",
    "–í —ç–ø–æ—Ö—É —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–æ—Ä—ã–≤–∞",
    "–í —Ä–∞–∑–≥–∞—Ä –º–µ–∂–¥–æ—É—Å–æ–±–∏—Ü –∫–ª–∞–Ω–æ–≤",
    "–°—Ä–µ–¥–∏ —Ö–∞–æ—Å–∞ —Ä–∞—Å–ø–∞–¥–∞—é—â–µ–π—Å—è –≤—Å–µ–ª–µ–Ω–Ω–æ–π",
    "–í –ø–µ—Ä–∏–æ–¥—ã —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏—è –¥—Ä–µ–≤–Ω–∏—Ö –∑–µ–º–µ–ª—å",
    "–ù–∞ –∑–∞—Ä–µ —Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–∞",
    "–í –¥–Ω–∏ –ø–æ–±–µ–¥–æ–Ω–æ—Å–Ω—ã—Ö –∑–∞–≤–æ–µ–≤–∞—Ç–µ–ª–µ–π",
    "–í —á–∞—Å—ã –≥–ª—É–±–æ–∫–∏—Ö —Å–æ–º–Ω–µ–Ω–∏–π —á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–∞"
]

async def start_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    #–û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –≤—ã–±–æ—Ä–æ–º —Å–µ—Ç—Ç–∏–Ω–≥–∞.
    keyboard = [[InlineKeyboardButton(theme, callback_data=f'theme_{theme}')] for theme in THEME_OPTIONS]
    await update.message.reply_text(
        "*–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π –¥–ª—è D&D!* –í—ã–±–µ—Ä–∏—Ç–µ –∂–∞–Ω—Ä –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è.",
        reply_markup=InlineKeyboardMarkup(keyboard),
        parse_mode="Markdown"
    )

async def generate_quest(update: Update, context: ContextTypes.DEFAULT_TYPE):
    #–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–≤–µ—Å—Ç–∞ –∏—Å—Ö–æ–¥—è –∏–∑ —Ä–∞–Ω–µ–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
    theme = context.user_data.get('theme')

    objective = random.choice(OBJECTIVES)
    twist = random.choice(TWISTS)
    reward = random.choice(REWARDS)
    place = random.choice(PLACES)
    encounter = random.choice(ENCOUNTERS)
    personality = random.choice(PERSONALITIES)
    background = random.choice(BACKGROUNDS)

    quest_text = f"""‚ú® *–ö–≤–µ—Å—Ç –≤ –º–∏—Ä–µ D&D*

–¢–µ–º–∞ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è: `{theme}`

üòé–¶–µ–ª—å –≥–µ—Ä–æ—è: {objective}  
üò±–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è: {twist}  
üòã–ù–∞–≥—Ä–∞–¥—ã: {reward}  

ü§†–í—Å—Ç—Ä–µ—á–∞ —Å —Å—É—â–µ—Å—Ç–≤–æ–º: {encounter}  
üåé–ú–µ—Å—Ç–æ –¥–µ–π—Å—Ç–≤–∏—è: {place}  
üë∫–í–∞–∂–Ω—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂: {personality}  
üåä–§–æ–Ω –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è: {background} 

–£–¥–∞—á–∏!
"""

    await update.callback_query.edit_message_text(
        quest_text,
        parse_mode="Markdown",
        reply_markup=None
    )

    new_keyboard = [[InlineKeyboardButton('–ù–æ–≤–æ–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ ‚ú®', callback_data='generate')]]
    await update.callback_query.message.reply_text(
        "–•–æ—Ç–∏—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è –≤ –Ω–æ–≤–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ?",
        reply_markup=InlineKeyboardMarkup(new_keyboard)
    )

async def button_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()

    data = query.data
    if data.startswith('theme_'):
        selected_theme = data.replace('theme_', '')
        context.user_data['theme'] = selected_theme
        await generate_quest(update, context)
    elif data == 'generate':
        await generate_quest(update, context)


def main():
    application = Application.builder().token("YOUR TOKEN").build()

    application.add_handler(CommandHandler("start", start_command))

    application.add_handler(CallbackQueryHandler(button_callback))

    application.run_polling()

if __name__ == '__main__':
    main()